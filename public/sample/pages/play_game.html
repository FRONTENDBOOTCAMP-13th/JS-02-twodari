<!doctype html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>코드의 그림자 - 게임</title>
    <script type="module" src="../TS/game_manager.ts"></script>
    <link rel="stylesheet" href="../../../src/style.css" />
    <style>
      /* 전체 문서 스타일 - 스크롤바 제거 및 전체 화면 설정 */
      body, html {
        margin: 0;
        padding: 0;
        overflow: hidden; /* 스크롤바 방지 */
        width: 100%;
        height: 100%;
        background-color: #000;
      }
      
      /* 메인 컨테이너 - 화면 중앙에 게임 배치 */
      #outer-container {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        display: flex;
        align-items: center;
        justify-content: center;
        overflow: hidden;
      }
      
      /* 게임 컨테이너 - 1920x1080 고정 크기로 설정 (16:9 비율) */
      #game-container {
        width: 1920px;
        height: 1080px;
        position: relative;
        transform-origin: center; /* 화면 크기 조정 시 중앙 기준으로 확대/축소 */
        min-width: 1280px; /* 최소 720p (1280x720) 해상도 유지 */
        min-height: 720px;
      }
      
      /* 방 배경 설정 */
      #room-background {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-position: center;
        background-size: cover; /* 배경 이미지가 항상 컨테이너를 채우도록 설정 */
      }
      
      /* 상호작용 요소와 UI 컴포넌트 영역 설정 */
      #interaction-elements, 
      #common-ui {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        pointer-events: none; /* 기본적으로는 클릭 무시, 필요한 요소만 별도로 클릭 활성화 */
      }
      
      /* z-index 레이어 설정 */
      #common-ui {
        z-index: 50; /* 공통 UI는 상호작용 요소보다 위에 */
      }
      
      #interaction-elements {
        z-index: 25; /* 상호작용 요소는 배경보다 위에, 공통 UI보다 아래에 */
      }
      
      /* 버튼과 상호작용 요소들에 클릭 활성화 */
      #btn-box, #timer, #direction-nav, .interaction-icon {
        pointer-events: auto;
      }
      
      /* 다이얼로그, 인벤토리, 미니게임 z-index */
      #dialog-box {
        z-index: 70; /* 대화창은 일반 UI 위에 */
      }
      
      #inventory {
        z-index: 80; /* 인벤토리는 대화창 위에 */
      }
      
      #minigame-container {
        z-index: 60; /* 미니게임은 일반 UI 위에, 대화창 아래에 */
      }
      
      /* 반응형 스타일 - 최소 720p 해상도 보장 */
      @media (max-width: 1280px), (max-height: 720px) {
        #outer-container {
          align-items: center;
          justify-content: center;
        }
        
        #game-container {
          transform-origin: center;
        }
      }
      
      /* 성능 최적화를 위한 설정 */
      #game-container {
        width: 1920px;
        height: 1080px;
        overflow: hidden;
        will-change: transform; /* GPU 가속 활용 */
      }
      
      /* 모든 요소가 컨테이너 크기에 맞게 유지 */
      #room-background, #interaction-elements, #common-ui {
        width: 100%;
        height: 100%;
      }
    </style>
  </head>
  <body class="ending-body bg-black">
    <!-- 게임 컨테이너 -->
    <div id="outer-container">
      <div id="game-container">
        <!-- 방 배경 - 각 방 클래스에서 이미지 변경 -->
        <div id="room-background"></div>
        
        <!-- 상호작용 요소들 - 돋보기 아이콘 등이 동적으로 추가됨 -->
        <div id="interaction-elements"></div>
        
        <!-- 공통 UI 컴포넌트 - 모든 방향에서 공통으로 사용되는 UI -->
        <div id="common-ui">
          <!-- 버튼들 (힌트, 음악, 아이템 등) -->
          <div id="btn-box" class="absolute top-10 left-10 flex gap-4 pointer-events-auto"></div>

          <!-- 남은 시간 표시 -->
          <div id="timer" class="absolute top-10 right-10 bg-black bg-opacity-70 p-2 rounded text-white pointer-events-auto">
            <span class="text-gray-300">남은 시간</span> <span id="time-value" class="text-red-500 font-bold">60:00</span>
          </div>

          <!-- 방향키 네비게이션 - 동서남북 이동 -->
          <div id="direction-nav" class="absolute bottom-10 right-10 grid grid-cols-3 gap-2 pointer-events-auto">
            <div></div>
            <button id="north-btn" class="direction-btn text-white bg-gray-800 hover:bg-gray-700 p-2 rounded">
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                <path d="M5 15l7-7 7 7H5z" />
              </svg>
              <span class="sr-only">N</span>
            </button>
            <div></div>
            <button id="west-btn" class="direction-btn text-white bg-gray-800 hover:bg-gray-700 p-2 rounded">
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                <path d="M15 19l-7-7 7-7v14z" />
              </svg>
              <span class="sr-only">W</span>
            </button>
            <div class="bg-gray-900 rounded flex items-center justify-center text-white">
              <span class="text-xs">방향</span>
            </div>
            <button id="east-btn" class="direction-btn text-white bg-gray-800 hover:bg-gray-700 p-2 rounded">
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                <path d="M9 5l7 7-7 7V5z" />
              </svg>
              <span class="sr-only">E</span>
            </button>
            <div></div>
            <button id="south-btn" class="direction-btn text-white bg-gray-800 hover:bg-gray-700 p-2 rounded">
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                <path d="M19 9l-7 7-7-7h14z" />
              </svg>
              <span class="sr-only">S</span>
            </button>
            <div></div>
          </div>
        </div>

        <!-- 미니게임 UI 컨테이너 - 미니게임 진행 시 보여짐 -->
        <div id="minigame-container" class="hidden absolute inset-0 bg-black bg-opacity-70 flex items-center justify-center"></div>

        <!-- 텍스트 대화창 - 상호작용 시 메시지 표시 -->
        <div id="dialog-box" class="hidden absolute bottom-20 left-1/2 transform -translate-x-1/2 w-4/5 bg-black bg-opacity-80 p-4 rounded text-white border border-gray-500">
          <p id="dialog-text" class="mb-4"></p>
          <button id="dialog-close" class="absolute bottom-2 right-2 px-4 py-1 bg-gray-700 hover:bg-gray-600 rounded">닫기</button>
        </div>

        <!-- 아이템 인벤토리 - 아이템 수집/사용 관리 -->
        <div id="inventory" class="hidden-element absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-3/4 h-3/4 bg-black bg-opacity-90 p-4 rounded border border-gray-500">
          <h2 class="text-white text-xl mb-4">인벤토리</h2>
          <div id="inventory-grid" class="grid grid-cols-4 gap-4"></div>
          <button id="inventory-close" class="absolute bottom-4 right-4 px-4 py-2 bg-gray-700 hover:bg-gray-600 rounded">닫기</button>
        </div>
      </div>
    </div>
  </body>
</html>
